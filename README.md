# DART Data Collection Pipeline

이 프로젝트는 오픈 API(DART)를 활용하여 한국거래소(유가증권/코스닥)에 상장된 기업들의 재무 데이터와 사업보고서 원문을 수집하는 파이프라인입니다. 

## 주요 기능

1. **상장사 필터링 및 메타데이터 구성**: 
   - `상장법인목록.xls`를 직접 읽어 회사명/종목코드/업종(D열)을 사용
   - 모든 JSON의 `industry_classification`에는 `"소분류"` 1개 필드만 저장하고, 값은 `상장법인목록.xls` D열 업종을 그대로 사용
2. **원시 데이터 수집 (DART API)**:
   - 기업의 최신 재무 상태표 수집 (연결/개별 재무제표 기준)
   - 2024년 결산 정기 공시 사업보고서에서 'II. 사업의 내용' 파트 원문 텍스트 추출 및 HTML 태그 정제
   - (2024년 사업보고서가 없는 기업은 `missing_2024_reports.log` 시스템에 별도 기록)
3. **로컬 저장**:
   - 추출된 개별 기업의 텍스트 데이터를 구조화된 JSON 포맷으로 `data/[상장법인목록 업종명]/` 디렉토리 하위에 분류하여 저장

## 필수 요구 사항 (Prerequisites)

- Python 3.8+
- DART API Key (환경 변수 `.env` 기반)
- 아래 Python 패키지:
  ```bash
  pip install pandas python-dotenv OpenDartReader beautifulsoup4 lxml requests openpyxl xlrd
  ```

## 설정 및 실행 방법

1. **DART API Key 발급 및 설정**
   - [DART 오픈API](https://opendart.fss.or.kr/) 사이트에서 API 키를 발급받습니다.
   - 프로젝트 루트 디렉토리에 `.env` 파일을 생성하고 아래와 같이 입력합니다.
     ```
     DART_API_KEY=당신의_DART_API_키를_입력하세요
     ```

2. **기초 데이터 파일 준비**
   - 한국거래소(KIND)에서 다운로드한 `상장법인목록.xls` 파일이 프로젝트 루트에 존재해야 합니다.

3. **스크립트 실행 (순서대로)**
   ```bash
   # 사업보고서 원문 수집 (checkpoint 기반, 중단 후 재개 가능)
   python collect_dart_manufacturing.py
   ```

   ```bash
   # (선택) 레거시 파일 정리만 필요한 경우
   python create_master_table.py
   ```

## 수집 결과 현황 (2024년 사업보고서 기준)

| 항목 | 수치 |
|---|---|
| 전체 상장사 | 1,472건 |
| 금융 및 보험업 (수집 제외) | 39건 |
| **수집 완료** | **1,433건 (100%)** |
| 사업내용 텍스트 추출 성공 | 1,424건 (99.4%) |
| 재무 데이터 적재 | 1,433건 (100%) |
| 업종별 폴더 수 | 128개 |

> **참고**: 사업내용 미추출 9건(0.6%)은 해당 기업의 사업보고서 HTML 구조가 자동 추출 패턴과 불일치한 경우입니다.

## 사업내용 미추출 기업 목록 (9건)

| 종목코드 | 기업명 |
|---|---|
| 047920 | HLB제약 |
| 105330 | 케이엔더블유 |
| 121600 | 나노신소재 |
| 124500 | 아이티센글로벌 |
| 136410 | 아셈스 |
| 215360 | 우리산업 |
| 225430 | 케이엠제약 |
| 303530 | 이노뎁 |
| 306620 | 지아이에스 |

## 향후 과제 (TODO)

- 사업내용 미추출 9건에 대한 수동 보완 (필요 시)
- LLM 기반 사업내용 요약 모델 연구 (팀원 배포 후)
- 대용량 데이터 적재를 위한 RDBMS (예: SQLite, MSSQL 등) 연동

## 산업분류 저장 기준 (현재)

- `industry_classification`은 `"소분류"`만 저장합니다.
- `"소분류"` 값은 `상장법인목록.xls` D열(업종) 원문입니다.
- 대분류/중분류/세분류/세세분류 코드는 현재 저장하지 않습니다.
